---
title: æ–°VPSå®Œæ•´åˆå§‹åŒ–æŒ‡å—ï¼šä»å®‰å…¨åŠ å›ºåˆ°ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
date: 2025-11-14 13:00:00
tags:
  - VPS
  - æœåŠ¡å™¨
  - Linux
  - å®‰å…¨
  - Docker
  - Nginx
categories:
  - Tech
cover: https://images.unsplash.com/photo-1558494949-ef010cbdcc31?w=800
description: è¯¦å°½çš„VPSåˆå§‹åŒ–æŒ‡å—ï¼Œæ¶µç›–å®‰å…¨åŠ å›ºã€ç³»ç»Ÿä¼˜åŒ–ã€é•œåƒæºæ›¿æ¢å’ŒDockeréƒ¨ç½²ï¼Œç‰¹åˆ«é’ˆå¯¹ä¸­å›½å¤§é™†ç”¨æˆ·å’Œæ‰‹æœºproot-distroç¯å¢ƒä¼˜åŒ–
---

# æ–°VPSå®Œæ•´åˆå§‹åŒ–æŒ‡å—ï¼šä»å®‰å…¨åŠ å›ºåˆ°ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

![Linux Server](https://img.shields.io/badge/Linux-Server-orange)
![Security](https://img.shields.io/badge/Security-Hardened-green)
![Docker](https://img.shields.io/badge/Docker-Ready-blue)

## æ–‡ç« ç›®å½•

- [å‰è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦æ­£ç¡®åˆå§‹åŒ–VPS](#å‰è¨€ä¸ºä»€ä¹ˆéœ€è¦æ­£ç¡®åˆå§‹åŒ–vps)
- [ç¬¬ I éƒ¨åˆ†ï¼šåŸºç¡€ç³»ç»Ÿé…ç½®](#ç¬¬-i-éƒ¨åˆ†åŸºç¡€ç³»ç»Ÿé…ç½®)
  - [1. é¦–æ¬¡ç™»å½•ä¸ç³»ç»Ÿæ›´æ–°](#1-é¦–æ¬¡ç™»å½•ä¸ç³»ç»Ÿæ›´æ–°)
  - [2. åˆ›å»ºæ–°ç”¨æˆ·å¹¶æˆäºˆç®¡ç†å‘˜æƒé™](#2-åˆ›å»ºæ–°ç”¨æˆ·å¹¶æˆäºˆç®¡ç†å‘˜æƒé™)
  - [3. è®¾ç½®ç³»ç»Ÿæ—¶åŒº](#3-è®¾ç½®ç³»ç»Ÿæ—¶åŒº)
- [ç¬¬ II éƒ¨åˆ†ï¼šå®‰å…¨åŠ å›º](#ç¬¬-ii-éƒ¨åˆ†å®‰å…¨åŠ å›º)
  - [1. SSHå®‰å…¨é…ç½®](#1-sshå®‰å…¨é…ç½®)
  - [2. é…ç½®åŸºç¡€é˜²ç«å¢™](#2-é…ç½®åŸºç¡€é˜²ç«å¢™)
  - [3. å®‰è£…Fail2bané˜²å¾¡å·¥å…·](#3-å®‰è£…fail2bané˜²å¾¡å·¥å…·)
  - [4. ä½¿ç”¨SSHå¯†é’¥ç™»å½•](#4-ä½¿ç”¨sshå¯†é’¥ç™»å½•)
- [ç¬¬ III éƒ¨åˆ†ï¼šç³»ç»Ÿä¼˜åŒ–ä¸å·¥å…·å®‰è£…](#ç¬¬-iii-éƒ¨åˆ†ç³»ç»Ÿä¼˜åŒ–ä¸å·¥å…·å®‰è£…)
  - [1. ä¸­å›½å¤§é™†ç”¨æˆ·é•œåƒæºæ›¿æ¢](#1-ä¸­å›½å¤§é™†ç”¨æˆ·é•œåƒæºæ›¿æ¢)
  - [2. åŸºç¡€å·¥å…·å®‰è£…](#2-åŸºç¡€å·¥å…·å®‰è£…)
  - [3. å®‰è£…Dockerå’ŒDocker Compose](#3-å®‰è£…dockerå’Œdocker-compose)
- [ç¬¬ IV éƒ¨åˆ†ï¼šç”Ÿäº§ç¯å¢ƒé…ç½®](#ç¬¬-iv-éƒ¨åˆ†ç”Ÿäº§ç¯å¢ƒé…ç½®)
  - [1. ä½¿ç”¨Nginx Proxy Managerç®¡ç†åå‘ä»£ç†](#1-ä½¿ç”¨nginx-proxy-managerç®¡ç†åå‘ä»£ç†)
  - [2. Dockerç½‘ç»œä¸å®‰å…¨é…ç½®](#2-dockerç½‘ç»œä¸å®‰å…¨é…ç½®)
- [ç¬¬ V éƒ¨åˆ†ï¼šç‰¹æ®Šç¯å¢ƒé…ç½®](#ç¬¬-v-éƒ¨åˆ†ç‰¹æ®Šç¯å¢ƒé…ç½®)
  - [1. æ‰‹æœºproot-distroç¯å¢ƒç‰¹åˆ«è¯´æ˜](#1-æ‰‹æœºproot-distroç¯å¢ƒç‰¹åˆ«è¯´æ˜)
  - [2. å¿…è¦åŸºç¡€ä¾èµ–å®‰è£…æ¸…å•](#2-å¿…è¦åŸºç¡€ä¾èµ–å®‰è£…æ¸…å•)
- [æ€»ç»“ä¸åç»­å»ºè®®](#æ€»ç»“ä¸åç»­å»ºè®®)
- [å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ](#å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ)

> ğŸ’¡ **æç¤º**ï¼šåœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿æ‚¨å·²è·å–VPSçš„IPåœ°å€ã€åˆå§‹ç”¨æˆ·åå’Œå¯†ç ã€‚
> 
> âš ï¸ **æ³¨æ„**ï¼šæœ¬æŒ‡å—é€‚ç”¨äºDebian/Ubuntuç³»ç»Ÿï¼Œå…¶ä»–å‘è¡Œç‰ˆå¯èƒ½éœ€è¦é€‚å½“è°ƒæ•´å‘½ä»¤ã€‚

---

## å‰è¨€ï¼šä¸ºä»€ä¹ˆéœ€è¦æ­£ç¡®åˆå§‹åŒ–VPS

æ­å–œä½ æ‹¥æœ‰äº†ä¸€å°å±äºè‡ªå·±çš„äº‘æœåŠ¡å™¨ï¼ˆVPSï¼‰ï¼è¿™æ˜¯ä¸€ç‰‡å……æ»¡æ— é™å¯èƒ½çš„æ•°å­—å¤©åœ°ã€‚ä½†åœ¨ä½ å¼€å§‹éƒ¨ç½²ç½‘ç«™ã€æ­å»ºåº”ç”¨ä¹‹å‰ï¼ŒåŠ¡å¿…å…ˆèŠ±ä¸Š15-30åˆ†é’Ÿï¼Œå®Œæˆä¸€äº›è‡³å…³é‡è¦çš„åŸºç¡€è®¾ç½®ã€‚è¿™ä¸ä»…èƒ½ä¿æŠ¤ä½ çš„æœåŠ¡å™¨å…å—æœ€å¸¸è§çš„ç½‘ç»œæ”»å‡»ï¼Œè¿˜èƒ½ä¸ºä½ æœªæ¥çš„ç®¡ç†å·¥ä½œæä¾›ä¾¿åˆ©ã€‚

ä¸€ä¸ªæœªç»æ­£ç¡®åˆå§‹åŒ–çš„VPSå°±åƒä¸€æ ‹æ²¡æœ‰é—¨çª—çš„æˆ¿å­ï¼Œä»»ä½•äººéƒ½å¯ä»¥éšæ„è¿›å‡ºã€‚æ ¹æ®ç»Ÿè®¡ï¼Œä¸€å°æ–°æš´éœ²åœ¨äº’è”ç½‘ä¸Šçš„æœåŠ¡å™¨ï¼Œå¹³å‡åœ¨**å‡ åˆ†é’Ÿå†…**å°±ä¼šå—åˆ°è‡ªåŠ¨åŒ–æ‰«æå·¥å…·çš„æ¢æµ‹ï¼Œ**å‡ å°æ—¶å†…**å°±å¯èƒ½é­å—æš´åŠ›ç ´è§£æ”»å‡»ã€‚

æœ¬æ–‡å°†ä»¥ä¸€å°å…¨æ–°çš„ã€åŸºäºUbuntu/Debianç³»ç»Ÿçš„VPSä¸ºä¾‹ï¼Œæ‰‹æŠŠæ‰‹å¸¦ä½ å®Œæˆä»ç™»å½•åˆ°åŸºç¡€åŠ å›ºçš„å…¨è¿‡ç¨‹ã€‚æ— è®ºä½ æ˜¯VPSæ–°æ‰‹è¿˜æ˜¯æœ‰ä¸€å®šç»éªŒçš„ç®¡ç†å‘˜ï¼Œéƒ½èƒ½ä»ä¸­æ‰¾åˆ°æœ‰ä»·å€¼çš„å†…å®¹ã€‚

## ç¬¬ I éƒ¨åˆ†ï¼šåŸºç¡€ç³»ç»Ÿé…ç½®

### 1. é¦–æ¬¡ç™»å½•ä¸ç³»ç»Ÿæ›´æ–°

é¦–å…ˆï¼Œæˆ‘ä»¬ä»¥rootç”¨æˆ·èº«ä»½ç™»å½•åˆ°æœåŠ¡å™¨ã€‚rootæ˜¯Linuxç³»ç»Ÿä¸­çš„è¶…çº§ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æœ€é«˜æƒé™ã€‚

```bash
ssh root@ä½ çš„æœåŠ¡å™¨IPåœ°å€
```

è¿æ¥è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå¯èƒ½ä¼šè¯¢é—®ä½ æ˜¯å¦ä¿¡ä»»è¯¥ä¸»æœºçš„æŒ‡çº¹ï¼Œè¾“å…¥`yes`å¹¶å›è½¦ã€‚æ¥ç€ï¼Œè¾“å…¥ä½ çš„åˆå§‹å¯†ç ã€‚æˆåŠŸç™»å½•åï¼Œä½ å°†çœ‹åˆ°æœåŠ¡å™¨çš„å‘½ä»¤è¡Œæ¬¢è¿ä¿¡æ¯ã€‚

ç™»å½•åçš„é¦–è¦ä»»åŠ¡æ˜¯æ›´æ–°ç³»ç»Ÿã€‚è¿™å¯ä»¥ç¡®ä¿æ‰€æœ‰å·²å®‰è£…çš„è½¯ä»¶åŒ…éƒ½æ‰“ä¸Šäº†æœ€æ–°çš„å®‰å…¨è¡¥ä¸ã€‚

```bash
# æŸ¥çœ‹ç³»ç»ŸåŸºæœ¬ä¿¡æ¯
uname -a

# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ä¿¡æ¯
apt update

# å‡çº§æ‰€æœ‰å·²å®‰è£…çš„è½¯ä»¶åŒ…
apt upgrade -y
```

è¿™é‡Œçš„ `-y` å‚æ•°ä¼šè‡ªåŠ¨ç¡®è®¤æ‰€æœ‰å‡çº§æç¤ºï¼ŒèŠ‚çœæ—¶é—´ã€‚

### 2. åˆ›å»ºæ–°ç”¨æˆ·å¹¶æˆäºˆç®¡ç†å‘˜æƒé™

ä¸€ç›´ä½¿ç”¨rootç”¨æˆ·æ“ä½œæœåŠ¡å™¨æ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„ä¹ æƒ¯ã€‚ä»»ä½•è¯¯æ“ä½œéƒ½å¯èƒ½å¯¹ç³»ç»Ÿé€ æˆæ¯ç­æ€§æ‰“å‡»ï¼Œå¹¶ä¸”å®ƒä¹Ÿæ˜¯é»‘å®¢ä»¬æœ€å–œæ¬¢æ”»å‡»çš„ç›®æ ‡ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥å¸¸ä½¿ç”¨è´¦æˆ·ï¼Œå¹¶èµ‹äºˆå®ƒsudoæƒé™ï¼ˆå³åœ¨éœ€è¦æ—¶ä¸´æ—¶è·å–ç®¡ç†å‘˜æƒé™ï¼‰ã€‚

```bash
# åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ· (å°† your_username æ›¿æ¢ä¸ºä½ æƒ³è¦çš„ç”¨æˆ·å)
adduser your_username
```

ç³»ç»Ÿä¼šæç¤ºä½ è®¾ç½®æ–°ç”¨æˆ·çš„å¯†ç å’Œä¸€äº›å¯é€‰çš„ä¸ªäººä¿¡æ¯ï¼ˆå¯ä»¥ç›´æ¥å›è½¦è·³è¿‡ï¼‰ã€‚è¯·åŠ¡å¿…è®¾ç½®ä¸€ä¸ªå¼ºå¯†ç ã€‚

```bash
# æˆäºˆsudoæƒé™
usermod -aG sudo your_username
```

è¿™æ¡å‘½ä»¤å°†æ–°åˆ›å»ºçš„ç”¨æˆ·æ·»åŠ åˆ°äº†sudoç”¨æˆ·ç»„ï¼Œä½¿å…¶èƒ½å¤Ÿæ‰§è¡Œç®¡ç†å‘˜å‘½ä»¤ã€‚

éªŒè¯æ–°ç”¨æˆ·ï¼šç°åœ¨ï¼Œé€€å‡ºrootç™»å½• (`exit`)ï¼Œç„¶åç”¨ä½ çš„æ–°ç”¨æˆ·åé‡æ–°ç™»å½•ï¼š

```bash
ssh your_username@ä½ çš„æœåŠ¡å™¨IPåœ°å€
```

ç™»å½•åï¼Œå°è¯•æ‰§è¡Œä¸€ä¸ªéœ€è¦sudoçš„å‘½ä»¤æ¥éªŒè¯æƒé™æ˜¯å¦ç”Ÿæ•ˆï¼Œæ¯”å¦‚æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼š

```bash
sudo apt update
```

ç³»ç»Ÿä¼šè¦æ±‚ä½ è¾“å…¥ä½ è‡ªå·±çš„å¯†ç ï¼ˆè€Œä¸æ˜¯rootå¯†ç ï¼‰ã€‚å¦‚æœå‘½ä»¤æˆåŠŸæ‰§è¡Œï¼Œè¯´æ˜æƒé™é…ç½®æ­£ç¡®ã€‚

### 3. è®¾ç½®ç³»ç»Ÿæ—¶åŒº

å°†ç³»ç»Ÿæ—¶é—´è®¾ç½®ä¸ºåŒ—äº¬æ—¶é—´ï¼Œæ¨èä½¿ç”¨ `timedatectl` å‘½ä»¤ã€‚

åŒ—äº¬æ—¶é—´çš„æ­£ç¡®æ—¶åŒºæ ‡è¯†ç¬¦æ˜¯ `Asia/Shanghai`ã€‚

```bash
# è®¾ç½®æ—¶åŒº
sudo timedatectl set-timezone Asia/Shanghai

# éªŒè¯æ›´æ”¹
timedatectl
```

æˆ–è€…ç®€å•åœ°ï¼š

```bash
date
```

è¾“å‡ºç°åœ¨åº”è¯¥æ˜¾ç¤º CSTï¼ˆä¸­å›½æ ‡å‡†æ—¶é—´ï¼‰å’Œæ­£ç¡®çš„æ—¶é—´ã€‚

## ç¬¬ II éƒ¨åˆ†ï¼šå®‰å…¨åŠ å›º

### 1. SSHå®‰å…¨é…ç½®

SSHæ˜¯æˆ‘ä»¬è¿œç¨‹ç®¡ç†æœåŠ¡å™¨çš„å”¯ä¸€å…¥å£ï¼Œä¿æŠ¤å¥½å®ƒè‡³å…³é‡è¦ã€‚

#### ç¦ç”¨rootç”¨æˆ·è¿œç¨‹ç™»å½•

æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†sudoç”¨æˆ·ï¼Œå°±åº”è¯¥ç¦æ­¢rootç›´æ¥é€šè¿‡SSHç™»å½•ã€‚

```bash
# ç”¨ä½ å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆå¦‚ nano æˆ– vimï¼‰æ‰“å¼€SSHé…ç½®æ–‡ä»¶
sudo nano /etc/ssh/sshd_config
```

åœ¨æ–‡ä»¶ä¸­æ‰¾åˆ° `PermitRootLogin` è¿™ä¸€è¡Œï¼Œä¿®æ”¹ä¸º `no`ï¼š

```bash
PermitRootLogin no
```

å¦‚æœè¿™ä¸€è¡Œå‰é¢æœ‰ `#`ï¼Œè¯·å°† `#` åˆ é™¤ã€‚

#### æ›´æ”¹é»˜è®¤SSHç«¯å£

SSHé»˜è®¤ä½¿ç”¨22ç«¯å£ï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºè‡ªåŠ¨åŒ–æ‰«æå’Œæ”»å‡»çš„é¦–è¦ç›®æ ‡ã€‚é€šè¿‡æ›´æ”¹ç«¯å£ï¼Œå¯ä»¥æœ‰æ•ˆé¿å¼€å¤§éƒ¨åˆ†çš„è‡ªåŠ¨æ”»å‡»ã€‚ä¸è¿‡å¯¹äºä¸ªäººç”¨æˆ·ä¹Ÿæ²¡å¿…è¦è¿‡äºæ‹…å¿ƒã€‚

åœ¨åŒä¸€ä¸ªé…ç½®æ–‡ä»¶ (`/etc/ssh/sshd_config`) ä¸­ï¼Œæ‰¾åˆ° `#Port 22` è¿™ä¸€è¡Œã€‚é¦–å…ˆå»æ‰ `#`ï¼Œç„¶åå°† `22` æ”¹æˆä¸€ä¸ªä¸å¸¸ç”¨çš„ç«¯å£å·ï¼ˆèŒƒå›´å»ºè®®åœ¨ 1024-65535 ä¹‹é—´ï¼Œä¾‹å¦‚ 2255ï¼‰ã€‚

```bash
Port 2255
```

> **é‡è¦æç¤º**ï¼šåœ¨ä¿®æ”¹ç«¯å£åï¼Œè¯·åŠ¡å¿…å…ˆé…ç½®å¥½é˜²ç«å¢™ï¼ˆä¸‹ä¸€æ­¥ï¼‰å¹¶å…è®¸æ–°ç«¯å£é€šè¿‡ï¼Œå¦åˆ™ä½ å¯èƒ½ä¼šå°†è‡ªå·±é”åœ¨æœåŠ¡å™¨å¤–é¢ï¼

#### åº”ç”¨æ›´æ”¹

ä¿å­˜æ–‡ä»¶å¹¶é€€å‡º (nanoä¸­æŒ‰ `Ctrl+X`, ç„¶åæŒ‰ `Y`, æœ€åæŒ‰å›è½¦)ã€‚æ¥ç€ï¼Œé‡å¯SSHæœåŠ¡è®©é…ç½®ç”Ÿæ•ˆã€‚

```bash
sudo systemctl restart sshd
```

> **è­¦å‘Š**ï¼šä¸è¦ç«‹å³å…³é—­å½“å‰çš„SSHè¿æ¥ï¼æ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯çª—å£ï¼Œå°è¯•ç”¨æ–°çš„ç«¯å£å’Œæ–°çš„ç”¨æˆ·åç™»å½•ï¼Œç¡®ä¿ä¸€åˆ‡æ­£å¸¸ã€‚

```bash
ssh -p æ–°ç«¯å£å· your_username@ä½ çš„æœåŠ¡å™¨IPåœ°å€
# ç¤ºä¾‹: ssh -p 2255 your_username@192.0.2.1
```

ç¡®è®¤æ–°è¿æ¥æˆåŠŸåï¼Œå†å…³é—­æ—§çš„è¿æ¥ã€‚

### 2. é…ç½®åŸºç¡€é˜²ç«å¢™

é˜²ç«å¢™æ˜¯æœåŠ¡å™¨çš„ç¬¬ä¸€é“é˜²çº¿ã€‚UFW (Uncomplicated Firewall) æ˜¯ä¸€ä¸ªéå¸¸æ˜“äºä½¿ç”¨çš„é˜²ç«å¢™ç®¡ç†å·¥å…·ï¼Œä½¿ç”¨ç³»ç»Ÿåº•å±‚çš„iptablesè¿›è¡Œè®¾ç½®ã€‚

```bash
# å®‰è£…UFW (é€šå¸¸å·²é¢„è£…)
sudo apt install ufw

# è®¾ç½®é»˜è®¤è§„åˆ™: å…ˆç¦æ­¢æ‰€æœ‰ä¼ å…¥è¿æ¥ï¼Œå…è®¸æ‰€æœ‰ä¼ å‡ºè¿æ¥
sudo ufw default deny incoming
sudo ufw default allow outgoing
```

å…è®¸å¿…è¦çš„è¿æ¥ï¼šæˆ‘ä»¬éœ€è¦å…è®¸SSHã€HTTPå’ŒHTTPSçš„æµé‡è¿›å…¥ã€‚

```bash
# å¦‚æœä½ æ²¡æœ‰æ”¹SSHç«¯å£
sudo ufw allow ssh # 22ç«¯å£

# å¦‚æœä½ æ”¹äº†SSHç«¯å£ (ä¾‹å¦‚ 2233)
sudo ufw allow 2233/tcp

# å¦‚æœä½ è®¡åˆ’éƒ¨ç½²ç½‘ç«™ï¼Œä¹Ÿéœ€è¦å…è®¸HTTPå’ŒHTTPS
sudo ufw allow http  # 80ç«¯å£
sudo ufw allow https # 443ç«¯å£
```

å¯ç”¨é˜²ç«å¢™ï¼š

```bash
sudo ufw enable
```

ç³»ç»Ÿä¼šè­¦å‘Šä½ è¿™å¯èƒ½ä¼šä¸­æ–­ç°æœ‰è¿æ¥ï¼Œè¾“å…¥`y`ç¡®è®¤ã€‚å› ä¸ºæˆ‘ä»¬å·²ç»å…è®¸äº†SSHç«¯å£ï¼Œæ‰€ä»¥è¿æ¥ä¸ä¼šä¸­æ–­ã€‚

æ£€æŸ¥é˜²ç«å¢™çŠ¶æ€ï¼š

```bash
sudo ufw status verbose
```

è¿™å°†æ˜¾ç¤ºæ‰€æœ‰è§„åˆ™å’Œé˜²ç«å¢™çš„å½“å‰çŠ¶æ€ã€‚

### 3. å®‰è£…Fail2bané˜²å¾¡å·¥å…·

Fail2banï¼Œé¡¾åæ€ä¹‰æ˜¯é˜²æ­¢åå°æš´åŠ›æ‰«æçš„è½¯ä»¶ï¼Œé€šè¿‡åˆ†æç³»ç»Ÿæ—¥å¿—ä¸­çš„å¼‚å¸¸è¡Œä¸ºï¼ˆå¦‚å¤šæ¬¡ç™»å½•å¤±è´¥ï¼‰ï¼Œè‡ªåŠ¨å°ç¦å¯ç–‘ IP åœ°å€ï¼Œæœ‰æ•ˆæŠµå¾¡æš´åŠ›ç ´è§£æ”»å‡»ã€‚

```bash
# å®‰è£…Fail2ban
sudo apt update && sudo apt install fail2ban 
```

#### é…ç½® Fail2ban

åˆ›å»ºè‡ªå®šä¹‰é…ç½®ï¼Œå¤åˆ¶é»˜è®¤é…ç½®æ–‡ä»¶ï¼š

```bash
sudo cp /etc/fail2ban/jail.conf /etc/fail2ban/jail.local
```

ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š

```bash
sudo nano /etc/fail2ban/jail.local
```

å¸¸è§é…ç½®å‚æ•°ï¼š

```ini
[DEFAULT]
ignoreip = 127.0.0.1/8  # ç™½åå•IP
bantime = 3600          # å°ç¦æ—¶é•¿ï¼ˆç§’ï¼‰
findtime = 600          # æ£€æµ‹æ—¶é—´æ®µï¼ˆç§’ï¼‰
maxretry = 5            # æœ€å¤§å°è¯•æ¬¡æ•°

[sshd]                  # SSHæœåŠ¡é…ç½®
enabled = true          # å¯ç”¨ç›‘æ§
```

é‡å¯æœåŠ¡ï¼š

```bash
sudo systemctl restart fail2ban
sudo systemctl enable fail2ban  # å¼€æœºè‡ªå¯
```

æŸ¥çœ‹çŠ¶æ€ï¼š

```bash
sudo fail2ban-client status
```

æ£€æŸ¥å°ç¦åˆ—è¡¨ï¼š

```bash
sudo fail2ban-client status sshd
```

### 4. ä½¿ç”¨SSHå¯†é’¥ç™»å½•

ä½¿ç”¨SSHå¯†é’¥ç™»å½•æ˜¯è¿œç¨‹ç®¡ç†æœåŠ¡å™¨çš„æ ‡å‡†åšæ³•ï¼Œå®ƒæ¯”å¯†ç ç™»å½•æ›´å®‰å…¨ã€æ›´ä¾¿æ·ã€‚ä¸‹é¢æ˜¯ä¸€ä»½è¯¦å°½çš„æŒ‡å—ï¼Œå°†å¸¦ä½ å®Œæˆä»ç”Ÿæˆå¯†é’¥åˆ°å®ç°å…å¯†ç™»å½•çš„å…¨è¿‡ç¨‹ã€‚

è¿™ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸¤ä¸ªä¸»è¦æ­¥éª¤ï¼š
1. åœ¨ä½ çš„æœ¬åœ°ç”µè„‘ï¼ˆå®¢æˆ·ç«¯ï¼‰ä¸Šç”Ÿæˆå¯†é’¥å¯¹ã€‚
2. å°†å…¬é’¥ä¸Šä¼ åˆ°ä½ çš„æœåŠ¡å™¨ï¼ˆæœåŠ¡ç«¯ï¼‰ã€‚

#### 1. åœ¨ä½ çš„æœ¬åœ°ç”µè„‘ä¸Šç”ŸæˆSSHå¯†é’¥å¯¹

ä½ éœ€è¦å…ˆåœ¨è‡ªå·±çš„ç”µè„‘ï¼ˆè€Œä¸æ˜¯æœåŠ¡å™¨ï¼‰ä¸Šæ“ä½œã€‚å¯†é’¥å¯¹ç”±ä¸€ä¸ªç§é’¥å’Œä¸€ä¸ªå…¬é’¥ç»„æˆï¼š
- ç§é’¥ (id_ed25519): å¿…é¡»ä¸¥æ ¼ä¿å¯†ï¼Œç•™å­˜åœ¨ä½ çš„æœ¬åœ°ç”µè„‘ä¸Šï¼Œç›¸å½“äºä½ çš„"èº«ä»½è¯æ˜"ã€‚
- å…¬é’¥ (id_ed25519.pub): å¯ä»¥å®‰å…¨åœ°åˆ†äº«ï¼Œéœ€è¦è¢«æ”¾ç½®åœ¨ä½ æƒ³ç™»å½•çš„æœåŠ¡å™¨ä¸Šï¼Œç›¸å½“äºä¸€æŠŠ"é”"ã€‚

æ‰“å¼€ç»ˆç«¯ï¼š
- macOS / Linux: æ‰“å¼€"ç»ˆç«¯" (Terminal) åº”ç”¨ã€‚
- Windows: æ‰“å¼€ Windows Terminal, PowerShell, æˆ– Git Bashã€‚

è¿è¡Œå¯†é’¥ç”Ÿæˆå‘½ä»¤ï¼š

```bash
ssh-keygen -t ed25519 -C "your_email@example.com"
```

- `-t ed25519`: æŒ‡å®šå¯†é’¥ç±»å‹ä¸º Ed25519ã€‚å¦‚æœä½ çš„ç³»ç»Ÿå¾ˆè€ä¸æ”¯æŒï¼Œå¯ä»¥æ¢æˆ `rsa -b 4096`ã€‚
- `-C "your_email@example.com"`: æ·»åŠ ä¸€æ®µæ³¨é‡Šï¼Œé€šå¸¸ç”¨é‚®ç®±æ¥æ ‡è¯†è¿™ä¸ªå¯†é’¥æ˜¯è°çš„ã€ç”¨åœ¨å“ªå°ç”µè„‘ä¸Šï¼Œæ–¹ä¾¿ç®¡ç†ã€‚

æ ¹æ®æç¤ºæ“ä½œï¼š

è¿è¡Œå‘½ä»¤åï¼Œç³»ç»Ÿä¼šé—®ä½ å‡ ä¸ªé—®é¢˜ï¼š

1. `Enter file in which to save the key (â€¦):`
   æç¤ºä½ ä¿å­˜å¯†é’¥çš„ä½ç½®ã€‚ç›´æ¥æŒ‰å›è½¦å³å¯ï¼Œå®ƒä¼šä½¿ç”¨é»˜è®¤è·¯å¾„ï¼ˆé€šå¸¸æ˜¯ `~/.ssh/id_ed25519`ï¼‰ã€‚

2. `Enter passphrase (empty for no passphrase):`
   æç¤ºä½ ä¸ºç§é’¥è®¾ç½®ä¸€ä¸ªå¯†ç ï¼ˆPassphraseï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„å®‰å…¨å±‚ï¼
   - **å¼ºçƒˆå»ºè®®è®¾ç½®å¯†ç **: å³ä½¿ä½ çš„ç”µè„‘è¢«ç›—ï¼Œç§é’¥æ–‡ä»¶æ³„éœ²ï¼Œæ²¡æœ‰è¿™ä¸ªå¯†ç ï¼Œåˆ«äººä¹Ÿæ— æ³•ä½¿ç”¨å®ƒã€‚
   - **ä¸è®¾ç½®å¯†ç **: ç›´æ¥æŒ‰å›è½¦ã€‚ç™»å½•æ—¶ä¼šæ›´æ–¹ä¾¿ï¼Œä½†å®‰å…¨æ€§ç¨ä½ã€‚

3. `Enter same passphrase again:`
   å†æ¬¡è¾“å…¥ä½ è®¾ç½®çš„å¯†ç è¿›è¡Œç¡®è®¤ã€‚

å®Œæˆåï¼Œä½ ä¼šåœ¨ `~/.ssh` ç›®å½•ä¸‹çœ‹åˆ°ä¸¤ä¸ªæ–°æ–‡ä»¶ï¼š`id_ed25519` (ç§é’¥) å’Œ `id_ed25519.pub` (å…¬é’¥)ã€‚

#### 2. å°†ä½ çš„å…¬é’¥å¤åˆ¶åˆ°æœåŠ¡å™¨

è¦å®ç°å…å¯†ç™»å½•ï¼Œä½ éœ€è¦æŠŠåˆšåˆšç”Ÿæˆçš„å…¬é’¥ (id_ed25519.pub) çš„å†…å®¹ï¼Œæ·»åŠ åˆ°æœåŠ¡å™¨ä¸Šä½ å¸Œæœ›ç™»å½•çš„é‚£ä¸ªç”¨æˆ·çš„ `~/.ssh/authorized_keys` æ–‡ä»¶ä¸­ã€‚

ä»¥ä¸‹ä»‹ç»ä¸¤ç§æ–¹æ³•ï¼Œå¼ºçƒˆæ¨èä½¿ç”¨æ–¹æ³•Aã€‚

**æ–¹æ³• 1ï¼šä½¿ç”¨ ssh-copy-id (æœ€ç®€å•ã€æœ€æ¨è)**

è¿™ä¸ªå‘½ä»¤ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰æ“ä½œï¼ŒåŒ…æ‹¬åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºç›®å½•ã€è®¾ç½®æ–‡ä»¶å’Œä¿®æ­£æƒé™ï¼Œèƒ½æœ‰æ•ˆé¿å…æ‰‹åŠ¨æ“ä½œçš„å¤±è¯¯ã€‚

```bash
# æ‰§è¡Œå‘½ä»¤ (å°† your_username æ›¿æ¢æˆä½ åœ¨æœåŠ¡å™¨ä¸Šçš„ç”¨æˆ·åï¼Œserver_ip æ›¿æ¢æˆæœåŠ¡å™¨çš„IPåœ°å€)
ssh-copy-id your_username@server_ip

# å¦‚æœä½ ä¿®æ”¹è¿‡SSHç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨ -p å‚æ•°
ssh-copy-id -p ç«¯å£å· your_username@server_ip

# å¦‚æœä½ çš„å¯†é’¥ä¸åœ¨é»˜è®¤è·¯å¾„ï¼Œå¯ä»¥ä½¿ç”¨ -i å‚æ•°
ssh-copy-id -i ~/.ssh/my_other_key.pub your_username@server_ip
```

è¾“å…¥æœåŠ¡å™¨å¯†ç ï¼š
ç³»ç»Ÿä¼šæç¤ºä½ è¾“å…¥ `your_username` è¿™ä¸ªç”¨æˆ·åœ¨æœåŠ¡å™¨ä¸Šçš„å¯†ç ã€‚è¿™æ˜¯ä½ æœ€åä¸€æ¬¡éœ€è¦ç”¨å¯†ç ç™»å½•ã€‚

è¾“å…¥å¯†ç åï¼Œå‘½ä»¤ä¼šè‡ªåŠ¨å°†ä½ çš„å…¬é’¥å†…å®¹è¿½åŠ åˆ°æœåŠ¡å™¨çš„ `~/.ssh/authorized_keys` æ–‡ä»¶ä¸­ã€‚

**æ–¹æ³• 2ï¼šæ‰‹åŠ¨å¤åˆ¶ç²˜è´´ (å½“æ²¡æœ‰ssh-copy-idæ—¶)**

å¦‚æœä½ çš„æœ¬åœ°ç”µè„‘ï¼ˆæ¯”å¦‚æŸäº›Windowsç¯å¢ƒï¼‰æ²¡æœ‰ `ssh-copy-id` å‘½ä»¤ï¼Œå°±éœ€è¦æ‰‹åŠ¨æ“ä½œã€‚

1. åœ¨æœ¬åœ°ç”µè„‘ä¸Šï¼Œæ˜¾ç¤ºå¹¶å¤åˆ¶å…¬é’¥å†…å®¹ï¼š
   ```bash
   cat ~/.ssh/id_ed25519.pub
   ```
   ç»ˆç«¯ä¼šæ˜¾ç¤ºä¸€é•¿ä¸²ä»¥ `ssh-ed25519 ...` å¼€å¤´çš„æ–‡æœ¬ã€‚å®Œæ•´åœ°å¤åˆ¶è¿™ä¸€æ•´è¡Œã€‚

2. ç”¨å¯†ç ç™»å½•åˆ°ä½ çš„æœåŠ¡å™¨ï¼š
   ```bash
   ssh your_username@server_ip
   ```

3. åœ¨æœåŠ¡å™¨ä¸Šï¼Œå°†å…¬é’¥å†™å…¥ authorized_keys æ–‡ä»¶ï¼š
   ```bash
   # ç¡®ä¿ .ssh ç›®å½•å­˜åœ¨
   mkdir -p ~/.ssh

   # å°†ä½ å¤åˆ¶çš„å…¬é’¥å†…å®¹ç²˜è´´åˆ°è¿™é‡Œï¼Œç„¶åå›è½¦
   echo "åœ¨è¿™é‡Œç²˜è´´ä½ çš„å…¬é’¥å†…å®¹" >> ~/.ssh/authorized_keys

   # ä¿®æ­£å…³é”®çš„ç›®å½•å’Œæ–‡ä»¶æƒé™ï¼Œè¿™ä¸€æ­¥è‡³å…³é‡è¦ï¼
   chmod 700 ~/.ssh
   chmod 600 ~/.ssh/authorized_keys
   ```

> **æ³¨æ„**: å¦‚æœæƒé™ä¸æ­£ç¡®ï¼ˆä¾‹å¦‚è¿‡äºå¼€æ”¾ï¼‰ï¼ŒSSHä¸ºäº†å®‰å…¨ä¼šæ‹’ç»ä½¿ç”¨å¯†é’¥ç™»å½•ã€‚700æ„å‘³ç€åªæœ‰ä½ è‡ªå·±èƒ½è¯»ã€å†™ã€æ‰§è¡Œè¯¥ç›®å½•ï¼Œ600æ„å‘³ç€åªæœ‰ä½ è‡ªå·±èƒ½è¯»ã€å†™è¯¥æ–‡ä»¶ã€‚

è¿˜å¯ä»¥ä½¿ç”¨ä¸€äº›SSHå®¢æˆ·ç«¯ï¼ˆå¦‚XShellã€MobaXtermï¼‰èƒ½ç›´æ¥åœ¨å®¢æˆ·ç«¯é‡Œé¢ç”Ÿæˆæœ¬åœ°çš„å¯†é’¥å¯¹ï¼Œç”Ÿæˆåèƒ½ç›´æ¥ä¸€é”®å¯¼å…¥åˆ°æœåŠ¡å™¨ä¸­ï¼Œä¹Ÿæ˜¯éå¸¸æ–¹ä¾¿ã€‚åƒ Termius è¿™æ ·èƒ½å¤Ÿäº‘ç«¯åŒæ­¥çš„SSHå®¢æˆ·ç«¯èƒ½å¤Ÿè®©ä½ åœ¨ä¸åŒè®¾å¤‡ä¸Šä½¿ç”¨åŒä¸€å¥—å¯†é’¥å¯¹ï¼Œæ¯æ¬¡æ¢ä¸åŒè®¾å¤‡ï¼Œéƒ½ä¸å†éœ€è¦é‡æ–°ç”Ÿæˆå¯†é’¥å¹¶æ·»åŠ åˆ°æœåŠ¡å™¨é‡Œï¼Œæœ‰ç€æå¤§çš„ä¾¿åˆ©æ€§è¿˜èƒ½é›†ä¸­ç®¡ç†å¤šä¸ªå’ŒVPSå’Œå¯†é’¥ä¿¡æ¯ã€‚ä¸è¿‡å¦‚æœä½ çš„è´¦å·éªŒè¯ä¿¡æ¯è¢«æ³„éœ²ï¼Œé‚£ä¹ˆä½ çš„å…¨éƒ¨å¯†é’¥éƒ½é­æ®ƒï¼ŒVPSä¹Ÿéƒ½èƒ½è¢«è®¿é—®ã€‚

#### 3. æµ‹è¯•ä¸æ”¶å°¾

æµ‹è¯•å…å¯†ç™»å½•ï¼š

é€€å‡ºæœåŠ¡å™¨ï¼Œç„¶åå†æ¬¡å°è¯•ç™»å½•ï¼š

```bash
ssh your_username@server_ip
```

å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œç³»ç»Ÿä¼šç›´æ¥è®©ä½ ç™»å½•ï¼Œè€Œä¸ä¼šå†è¯¢é—®å¯†ç ã€‚å¦‚æœä½ è®¾ç½®äº†å¯†é’¥çš„å¯†ç ï¼ˆPassphraseï¼‰ï¼Œæ­¤æ—¶ä¼šæç¤ºä½ è¾“å…¥è¯¥å¯†ç ã€‚

**(é‡è¦) ç¦ç”¨å¯†ç ç™»å½•**

ç¡®è®¤å¯†é’¥ç™»å½•æˆåŠŸåï¼Œä¸ºäº†è¾¾åˆ°æœ€é«˜çš„å®‰å…¨æ€§ï¼Œåº”è¯¥åœ¨æœåŠ¡å™¨ä¸Šç¦ç”¨å¯†ç ç™»å½•ï¼Œåªå…è®¸å¯†é’¥ç™»å½•ã€‚

```bash
# åœ¨æœåŠ¡å™¨ä¸Šç¼–è¾‘SSHé…ç½®æ–‡ä»¶
sudo nano /etc/ssh/sshd_config
```

æ‰¾åˆ° `PasswordAuthentication` è¿™ä¸€è¡Œï¼Œå»æ‰å‰é¢çš„ `#`ï¼Œå¹¶æŠŠå€¼æ”¹ä¸º `no`ã€‚

```bash
PasswordAuthentication no
```

åŒæ—¶ï¼Œå¯ä»¥ç¡®è®¤ `PubkeyAuthentication` æ˜¯ `yes` (é€šå¸¸é»˜è®¤å°±æ˜¯)ã€‚

ä¿å­˜æ–‡ä»¶ (Ctrl+X, Y, Enter) å¹¶é‡å¯SSHæœåŠ¡ï¼š

```bash
sudo systemctl restart sshd
```

> **è­¦å‘Š**ï¼šåœ¨æ‰§è¡Œè¿™ä¸€æ­¥ä¹‹å‰ï¼ŒåŠ¡å¿…ç¡®ä¿ä½ çš„å¯†é’¥ç™»å½•å·²ç»æµ‹è¯•æˆåŠŸã€‚å¦åˆ™ï¼Œä¸€æ—¦ç¦ç”¨å¯†ç ç™»å½•ï¼Œä½ å°†æ— æ³•å†ç™»å…¥ä½ çš„æœåŠ¡å™¨ï¼

ç°åœ¨ï¼Œä½ çš„æœåŠ¡å™¨å°±é…ç½®å¥½äº†é«˜åº¦å®‰å…¨çš„å¯†é’¥ç™»å½•æ–¹å¼ã€‚

## ç¬¬ III éƒ¨åˆ†ï¼šç³»ç»Ÿä¼˜åŒ–ä¸å·¥å…·å®‰è£…

### 1. ä¸­å›½å¤§é™†ç”¨æˆ·é•œåƒæºæ›¿æ¢

ç”±äºç½‘ç»œåŸå› ï¼Œä¸­å›½å¤§é™†ç”¨æˆ·ç›´æ¥è®¿é—®å®˜æ–¹è½¯ä»¶æºå¯èƒ½ä¼šå¾ˆæ…¢ã€‚æ›¿æ¢ä¸ºå›½å†…é•œåƒæºå¯ä»¥å¤§å¹…æå‡è½¯ä»¶åŒ…ä¸‹è½½é€Ÿåº¦ã€‚

#### Ubuntuç³»ç»Ÿé•œåƒæºæ›¿æ¢

```bash
# å¤‡ä»½åŸå§‹æºåˆ—è¡¨
sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak

# ç¼–è¾‘æºåˆ—è¡¨æ–‡ä»¶
sudo nano /etc/apt/sources.list
```

å°†åŸæœ‰å†…å®¹æ³¨é‡Šæ‰ï¼ˆåœ¨æ¯è¡Œå‰æ·»åŠ  `#`ï¼‰ï¼Œç„¶åæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆä»¥Ubuntu 22.04ä¸ºä¾‹ï¼‰ï¼š

```bash
# é˜¿é‡Œäº‘é•œåƒæº
deb https://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse

deb https://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse
```

æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼š

```bash
sudo apt update
```

#### Debianç³»ç»Ÿé•œåƒæºæ›¿æ¢

```bash
# å¤‡ä»½åŸå§‹æºåˆ—è¡¨
sudo cp /etc/apt/sources.list /etc/apt/sources.list.bak

# ç¼–è¾‘æºåˆ—è¡¨æ–‡ä»¶
sudo nano /etc/apt/sources.list
```

å°†åŸæœ‰å†…å®¹æ³¨é‡Šæ‰ï¼Œç„¶åæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼ˆä»¥Debian 11ä¸ºä¾‹ï¼‰ï¼š

```bash
# é˜¿é‡Œäº‘é•œåƒæº
deb https://mirrors.aliyun.com/debian/ bullseye main non-free contrib
deb-src https://mirrors.aliyun.com/debian/ bullseye main non-free contrib

deb https://mirrors.aliyun.com/debian-security/ bullseye-security main
deb-src https://mirrors.aliyun.com/debian-security/ bullseye-security main

deb https://mirrors.aliyun.com/debian/ bullseye-updates main non-free contrib
deb-src https://mirrors.aliyun.com/debian/ bullseye-updates main non-free contrib
```

æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨ï¼š

```bash
sudo apt update
```

> **æç¤º**ï¼šå…¶ä»–å›½å†…é•œåƒæºè¿˜åŒ…æ‹¬æ¸…åå¤§å­¦ã€ä¸­ç§‘å¤§ã€åä¸ºäº‘ç­‰ï¼Œå¯æ ¹æ®ç½‘ç»œæƒ…å†µé€‰æ‹©æœ€é€‚åˆçš„é•œåƒæºã€‚

### 2. åŸºç¡€å·¥å…·å®‰è£…

å®‰è£…ä¸€äº›å¸¸ç”¨çš„åŸºç¡€å·¥å…·ï¼Œæ–¹ä¾¿æ—¥å¸¸ç®¡ç†å’Œä½¿ç”¨ï¼š

```bash
# å®‰è£…å¸¸ç”¨å·¥å…·
sudo apt install -y curl wget git vim htop tree unzip zip

# å®‰è£…ç½‘ç»œå·¥å…·
sudo apt install -y net-tools dnsutils iproute2

# å®‰è£…ç¼–è¯‘å·¥å…·ï¼ˆå¦‚éœ€ç¼–è¯‘è½¯ä»¶ï¼‰
sudo apt install -y build-essential
```

### 3. å®‰è£…Dockerå’ŒDocker Compose

ä½¿ç”¨å®˜æ–¹çš„ä¸€é”®å®‰è£…è„šæœ¬å®‰è£…ã€‚

å®‰è£…è„šæœ¬çš„ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿åœ¨å—æ”¯æŒçš„ Linux å‘è¡Œç‰ˆä¸Šå¿«é€Ÿå®‰è£…æœ€æ–°çš„ Docker-CE ç‰ˆæœ¬ã€‚ä¸å»ºè®®ä¾èµ–æ­¤è„šæœ¬æ¥éƒ¨ç½²åˆ°ç”Ÿäº§ç³»ç»Ÿã€‚æœ‰å…³åœ¨å—æ”¯æŒçš„å‘è¡Œç‰ˆä¸Šå®‰è£…çš„æ›´è¯¦ç»†è¯´æ˜ï¼Œè¯·å‚é˜…å®‰è£…è¯´æ˜ã€‚

ä½ åªéœ€è¿è¡Œä»¥ä¸‹ä¸¤æ¡å‘½ä»¤ï¼Œå³å¯å®Œæˆæ‰€æœ‰å®‰è£…ã€‚

```bash
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
```

è„šæœ¬è¿è¡Œå®Œæ¯•åï¼ŒDocker å’Œ Docker Compose å°±å®‰è£…å¥½äº†ã€‚

æµ‹è¯•ä¸‹è‡ªå·±çš„VPSæœ‰æ²¡æœ‰å®‰è£…å¥½Dockeräº†ï¼š

```bash
which docker # /usr/bin/docker
```

ä¸ºäº†èƒ½ä¸åŠ  sudo ç›´æ¥è¿è¡Œ Docker å‘½ä»¤ï¼Œä½ ä»éœ€è¦æ‰§è¡Œä¸€æ¬¡ç”¨æˆ·æƒé™è®¾ç½®ï¼š

```bash
# å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ° docker ç”¨æˆ·ç»„
sudo usermod -aG docker $USER
```

æœ€åï¼Œçœ‹ä¸€ä¸‹dockerå’Œdocker composeçš„ç‰ˆæœ¬ï¼š

```bash
docker --version # Docker version 28.3.2, build 578ccf6
docker compose version # Docker Compose version v2.38.2
```

## ç¬¬ IV éƒ¨åˆ†ï¼šç”Ÿäº§ç¯å¢ƒé…ç½®

### 1. ä½¿ç”¨Nginx Proxy Managerç®¡ç†åå‘ä»£ç†

å¤§éƒ¨åˆ†äººä½¿ç”¨VPSæ¥éƒ¨ç½²æœåŠ¡éƒ½æ˜¯ä½¿ç”¨dockeræ¥éƒ¨ç½²ï¼Œæ¯”å¦‚WordPressç­‰ç­‰ï¼Œä½†æ˜¯ä½¿ç”¨dockeréƒ¨ç½²å®Œï¼Œä¸€èˆ¬éƒ½æ˜¯"IP+ç«¯å£å·"çš„æ–¹å¼æ¥è®¿é—®ï¼Œè¿™ç§æ–¹å¼ä¸ä»…æš´éœ²äº†æœåŠ¡å™¨çš„å†…éƒ¨ç»†èŠ‚ï¼Œæ˜¾å¾—ä¸ä¸“ä¸šï¼Œè¿˜å­˜åœ¨å®‰å…¨éšæ‚£ã€‚æ‰€ä»¥ä½¿ç”¨Nginxåå‘ä»£ç†æ˜¯å¿…ä¸å¯å°‘çš„ä¸€æ­¥ã€‚é€šè¿‡å°†æ‰€æœ‰æœåŠ¡æµé‡ç»Ÿä¸€ç”±Nginxè¿›è¡Œè½¬å‘ï¼Œæˆ‘ä»¬å¯ä»¥æå¤§åœ°æå‡éƒ¨ç½²çš„ä¸“ä¸šæ€§ã€å®‰å…¨æ€§ä¸çµæ´»æ€§ã€‚æˆ‘ä»¬åªéœ€è¦å¼€ä¸€ä¸ªç«¯å£ï¼Œå°±èƒ½è®¿é—®æ‰€æœ‰çš„VPSæœåŠ¡è¿›ç¨‹ã€‚

è¿™é‡Œæˆ‘ä»¬ç”¨NPMï¼ˆNginx Proxy Managerï¼‰æ¥ç»Ÿä¸€ç®¡ç†Nginxä»£ç†é…ç½®ã€Let's Encryptçš„SSLè¯ä¹¦è‡ªåŠ¨ç”³è¯·å’Œç»­æœŸã€‚

1. é¦–å…ˆæˆ‘ä»¬åˆ›å»ºå®‰è£…ç›®å½•ï¼š
```bash
# åˆ›å»ºå¹¶è¿›å…¥ç›®å½•
mkdir ~/docker/npm && cd ~/docker/npm
```

2. åˆ›å»ºcompose.ymlæ–‡ä»¶ï¼š
```bash
# åˆ›å»ºcomposeæ–‡ä»¶
nano compose.yml
```

3. å¤åˆ¶å†…å®¹ä¸‹é¢å†…å®¹å¹¶ç²˜è´´åˆ°æ–‡ä»¶ä¸­ï¼Œè¿™ä¸ª81ç«¯å£æ˜¯NPMçš„é»˜è®¤åå°ç«¯å£ï¼Œå»ºè®®ä¿®æ”¹ä¸ºä½ è‡ªå·±æƒ³è¦çš„ã€‚

```yaml
services:
  app:
    image: 'jc21/nginx-proxy-manager:latest'
    restart: unless-stopped
    ports:
      - '80:80'
      - '81:81'  # è¿™ä¸ªå°±æ˜¯ä½ è¦æš´éœ²åˆ°å…¬ç½‘ä¸Šçš„ç«¯å£
      - '443:443'
    volumes:
      - ./data:/data
      - ./letsencrypt:/etc/letsencrypt
```

4. åå°è¿è¡Œdocker composeå¯åŠ¨å®¹å™¨ï¼š
```bash
docker compose up -d
```

è®¿é—®ä½ çš„å…¬ç½‘IPåœ°å€ï¼Œä¼šæ˜¾ç¤ºä¸€ä¸ªNPMçš„ç¥è´ºæˆåŠŸé¡µé¢ï¼Œä»£è¡¨å®‰è£…NginxæˆåŠŸäº†ã€‚è®¿é—®å…¬ç½‘IP:81è¿›å…¥ç½‘é¡µï¼Œè¿›è¡Œåˆå§‹åŒ–ã€‚

NPMé»˜è®¤ç”¨æˆ·:
```
Email:    admin@example.com
Password: changeme
```

ç™»å½•åè¿›å»ä¿®æ”¹è´¦å·å¯†ç ã€‚

æ¥ä¸‹æ¥ä½ éœ€è¦æœ‰ä¸€ä¸ªåŸŸåï¼Œæˆ‘çš„åœ¨åŸŸåæ‰˜ç®¡åœ¨Cloudflareä¸Šï¼Œå…¶å®ƒåŸŸåæœåŠ¡å•†åº”è¯¥ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚åœ¨Cloudflareä¸Šå¯¹åŸŸåè¿›è¡ŒDNSè§£æï¼Œè‡ªå®šä¹‰ä¸€ä¸ªä¸‰çº§åŸŸåæ¯”å¦‚npmç”¨æ¥è®¿é—®NPMåå°é¡µé¢ï¼Œnpm.domain.comæŒ‡å‘ä½ çš„æœåŠ¡å™¨IPåœ°å€ã€‚ç„¶åæˆ‘ä»¬è®©NPMåå‘ä»£ç†è‡ªå·±ï¼Œå½“è®¿é—®npm.domain.comåŸŸåæ—¶ï¼ŒNPMä¼šè½¬å‘æµé‡åˆ°å†…éƒ¨ç½‘ç»œè¿›è¡Œè®¿é—®ã€‚

æˆ‘ä»¬åˆ›å»ºLet's Encryptçš„SSLè¯ä¹¦ï¼Œæ‰“å¼€NPMåå°é¡µé¢ï¼Œç‚¹å‡»SSL Certificatesï¼Œadd SSL Certificate â†’ Let's Encrypt â†’ ç„¶åæ·»åŠ ä¸‰çº§åŸŸå *.domain.comå’ŒäºŒçº§åŸŸådomain.com â†’ Use a DNS Challengeç„¶åé€‰æ‹©ä½ çš„DNSæä¾›å•†å¡«å…¥åŸŸåå¯†é’¥ä¿å­˜å°±è¡Œã€‚ç”³è¯·æˆåŠŸåæ·»åŠ ä»£ç†çš„æ—¶å€™å°±èƒ½åœ¨SSLé‚£é‡Œé€‰æ‹©è¯ä¹¦äº†ã€‚

### 2. Dockerç½‘ç»œä¸å®‰å…¨é…ç½®

é»˜è®¤é…ç½®ä¸‹ï¼ŒDockerçš„æš´éœ²çš„ç«¯å£è§„åˆ™ä¼šä¸UFWçš„è§„åˆ™å†²çªã€‚å®ƒä»¬é€šè¿‡ç›´æ¥ä¿®æ”¹åº•å±‚çš„iptablesè§„åˆ™æ¥æš´éœ²ç«¯å£ï¼Œæ‰€ä»¥dockeråˆ›å»ºçš„ç«¯å£ä¸è¢«UFWé˜²ç«å¢™æ‰€é™åˆ¶ã€‚å¦‚æœä½ ä¼šä½¿ç”¨iptableså°±ä¸éœ€è¦ä½¿ç”¨UFWï¼Œç›´æ¥ç”¨iptablesè¿›è¡Œé˜²ç«å¢™é…ç½®ã€‚é€šè¿‡ä¿®æ”¹iptablesä¹Ÿèƒ½è¿›è¡Œè®©dockeræ‰€æš´éœ²çš„ç«¯å£å—UFWæ‰€é™åˆ¶ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯è®©NPMé€šè¿‡è®¿é—®ä¸åŒdockerå®¹å™¨çš„å†…éƒ¨IPæ¥è¿›è¡Œä»£ç†ï¼Œæˆ‘ä»¬åˆ›å»ºdockerå®¹å™¨çš„æ—¶å€™ä¸éœ€è¦æš´éœ²åˆ°å…¬ç½‘ï¼Œåªéœ€è¦è®©NPMä¸å…¶ä»–å®¹å™¨åœ¨åŒä¸€dockerç½‘ç»œä¸‹å°±è¡Œã€‚

è¿™é‡Œæˆ‘ä»¬ç”¨Portaineræ¥è¿›è¡Œæ¼”ç¤ºï¼Œå°† Portainer åŠ å…¥äº† npm_default ç½‘ç»œï¼Œé€šè¿‡åŒæ ·è¿æ¥åˆ°è¿™ä¸ªç½‘ç»œçš„åå‘ä»£ç†NPMæ¥è®¿é—® Portainer çš„ Web ç•Œé¢ã€‚

1. é¦–å…ˆæˆ‘ä»¬åˆ›å»ºå®‰è£…ç›®å½•ï¼š
```bash
mkdir ~/docker/portainer && cd ~/docker/portainer
```

2. åˆ›å»ºå¦‚ä¸‹compose.ymlæ–‡ä»¶ï¼Œç„¶ååå°è¿è¡Œcomposeã€‚è¿™é‡Œä¸éœ€è¦æ·»åŠ ç«¯å£æ˜ å°„å…³ç³»ï¼Œå®¹å™¨ä½¿ç”¨NPMåˆ›å»ºçš„é»˜è®¤ç½‘ç»œnpm_defaultã€‚

```yaml
services:
  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    restart: always
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./portainer_data:/data
    networks:
      - npm_default 
networks:
  npm_default:
    external: true
```

æŸ¥çœ‹çš„å®¹å™¨çš„åç§°æˆ–IDï¼š
```bash
docker ps
```

ç„¶åï¼Œä½¿ç”¨ inspect å‘½ä»¤ã€‚å‡è®¾å®¹å™¨åå« portainerï¼š
```bash
docker inspect portainer
```

è¿™ä¼šè¾“å‡ºä¸€å¤§æ®µJSONæ ¼å¼çš„ä¿¡æ¯ã€‚æ‚¨éœ€è¦æ»šåŠ¨åˆ°æœ€ä¸‹é¢çš„ Networks éƒ¨åˆ†ï¼Œåœ¨é‚£é‡Œå¯ä»¥çœ‹åˆ°å®ƒåœ¨ä¸åŒç½‘ç»œä¸­çš„IPåœ°å€ã€‚

å¯ä»¥ä½¿ç”¨ `--format` æ ‡å¿—æ¥åªæå–IPåœ°å€ï¼Œè¿™æ ·æ›´æ¸…æ™°ï¼š
```bash
docker inspect -f '{% raw %}{{range.NetworkSettings.Networks}}{{.IPAddress}}{{end}}{% endraw %}' portainer
```

è¿™æ ·å°±è·å–åˆ°äº†å®¹å™¨çš„å†…éƒ¨IPäº†ï¼Œäºæ˜¯æˆ‘ä»¬å¯ä»¥åœ¨NPMä¸­å¯¹IPè¿›è¡Œä»£ç†ï¼Œæˆ‘ä»¬ä½¿ç”¨portainer.domain.comæ¥è®¿é—®é¡µé¢ï¼ŒSchemeä½¿ç”¨httpï¼ŒIPè¾“å…¥åˆšåˆšè·å–çš„å®¹å™¨IPæ¯”å¦‚172.18.0.3ï¼Œç«¯å£è¾“å…¥9000ã€‚SSLé€‰æ‹©åˆšåˆšçš„è¯ä¹¦*.domain.comï¼Œé€‰æ‹©Force SSLè¿›è¡Œå¼ºåˆ¶SSLè®¿é—®ç„¶åä¿å­˜ã€‚è¿™æ ·å°±å¯ä»¥é€šè¿‡åŸŸåæ¥è®¿é—®Portaineråå°äº†ã€‚

é€šè¿‡ä¸‹é¢å‘½ä»¤æ¥æŸ¥çœ‹npm_defaultç½‘ç»œä¸‹çš„å…¨éƒ¨ä¿¡æ¯ï¼š
```bash
docker network inspect npm_default
```

è¿™æ ·å…¶ä»–çš„dockeræœåŠ¡éƒ½å¯ä»¥æŒ‰ç…§è¿™ä¸ªæ–¹æ³•é€šè¿‡NPMæ¥åå‘ä»£ç†è¿›è¡Œè®¿é—®äº†ã€‚

## ç¬¬ V éƒ¨åˆ†ï¼šç‰¹æ®Šç¯å¢ƒé…ç½®

### 1. æ‰‹æœºproot-distroç¯å¢ƒç‰¹åˆ«è¯´æ˜

å¯¹äºä½¿ç”¨Termuxåœ¨æ‰‹æœºä¸Šé€šè¿‡proot-distroæ­å»ºçš„ç²¾ç®€Linuxç¯å¢ƒï¼Œç”±äºæƒé™å’Œç³»ç»Ÿæ¶æ„çš„é™åˆ¶ï¼Œéœ€è¦è¿›è¡Œä¸€äº›ç‰¹æ®Šé…ç½®ã€‚

#### æƒé™é™åˆ¶è¯´æ˜

åœ¨proot-distroç¯å¢ƒä¸­ï¼š
- æ— æ³•ä½¿ç”¨ç‰¹æƒç«¯å£ï¼ˆ<1024ï¼‰ï¼Œå¦‚SSHé»˜è®¤çš„22ç«¯å£
- æ— æ³•ç›´æ¥ä½¿ç”¨Dockerï¼Œå› ä¸ºç¼ºå°‘å¿…è¦çš„å†…æ ¸æ”¯æŒ
- ç³»ç»ŸæœåŠ¡ç®¡ç†å¯èƒ½å—é™ï¼Œå¦‚systemctlå¯èƒ½ä¸å¯ç”¨
- æ–‡ä»¶æƒé™å’ŒSELinux/AppArmorè§„åˆ™å¯èƒ½ä¸ç”Ÿæ•ˆ

#### æ›¿ä»£æ–¹æ¡ˆ

1. **ä½¿ç”¨éç‰¹æƒç«¯å£**ï¼š
   ```bash
   # SSHé…ç½®ç¤ºä¾‹
   Port 8022  # ä½¿ç”¨>1024çš„ç«¯å£
   ```

2. **ä½¿ç”¨serviceå‘½ä»¤æ›¿ä»£systemctl**ï¼š
   ```bash
   # å¯åŠ¨æœåŠ¡
   service ssh start
   
   # æ£€æŸ¥çŠ¶æ€
   service ssh status
   ```

3. **æ‰‹åŠ¨å¯åŠ¨æœåŠ¡**ï¼š
   ```bash
   # ç›´æ¥è¿è¡ŒæœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶
   /usr/sbin/sshd -D &
   ```

### 2. å¿…è¦åŸºç¡€ä¾èµ–å®‰è£…æ¸…å•

åœ¨ç²¾ç®€çš„proot-distroç¯å¢ƒä¸­ï¼Œè®¸å¤šåŸºç¡€å·¥å…·å¯èƒ½æœªé¢„è£…ã€‚ä»¥ä¸‹æ˜¯åœ¨Debian/Ubuntuç¯å¢ƒä¸­å»ºè®®å®‰è£…çš„åŸºç¡€ä¾èµ–ï¼š

```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
apt update

# å®‰è£…åŸºç¡€å·¥å…·
apt install -y curl wget git vim nano htop tree unzip zip

# å®‰è£…ç½‘ç»œå·¥å…·
apt install -y net-tools dnsutils iproute2 telnet

# å®‰è£…SSHæœåŠ¡
apt install -y openssh-server

# å®‰è£…æ–‡æœ¬ç¼–è¾‘å™¨
apt install -y nano vim

# å®‰è£…å‹ç¼©å·¥å…·
apt install -y unzip zip tar

# å®‰è£…è¿›ç¨‹ç®¡ç†å·¥å…·
apt install -y procps psmisc

# å®‰è£…è¯­è¨€ç¯å¢ƒ
apt install -y locales
locale-gen en_US.UTF-8
```

å¯¹äºä¸­å›½å¤§é™†ç”¨æˆ·ï¼ŒåŒæ ·å»ºè®®æ›¿æ¢ä¸ºå›½å†…é•œåƒæºä»¥åŠ é€Ÿä¸‹è½½ï¼š

```bash
# å¤‡ä»½åŸå§‹æºåˆ—è¡¨
cp /etc/apt/sources.list /etc/apt/sources.list.bak

# ç¼–è¾‘æºåˆ—è¡¨æ–‡ä»¶
nano /etc/apt/sources.list
```

ç„¶åæ ¹æ®ç³»ç»Ÿç‰ˆæœ¬æ·»åŠ å¯¹åº”çš„å›½å†…é•œåƒæºï¼ˆå‚è€ƒç¬¬IIIéƒ¨åˆ†çš„é•œåƒæºæ›¿æ¢å†…å®¹ï¼‰ã€‚

## æ€»ç»“ä¸åç»­å»ºè®®

è‡³æ­¤ï¼Œä½ çš„VPSå·²ç»å®Œæˆäº†åŸºç¡€çš„å®‰å…¨åŠ å›ºå’Œç³»ç»Ÿé…ç½®ã€‚è¿™åªæ˜¯ä¸€ä¸ªå¼€å§‹ï¼Œä»¥ä¸‹æ˜¯ä¸€äº›åç»­å»ºè®®ï¼š

1. **å®šæœŸæ›´æ–°ç³»ç»Ÿ**ï¼š
   ```bash
   sudo apt update && sudo apt upgrade -y
   ```

2. **è®¾ç½®è‡ªåŠ¨å®‰å…¨æ›´æ–°**ï¼š
   ```bash
   sudo apt install unattended-upgrades
   sudo dpkg-reconfigure -plow unattended-upgrades
   ```

3. **é…ç½®æ—¥å¿—ç›‘æ§**ï¼š
   ```bash
   sudo apt install logwatch
   ```

4. **è®¾ç½®å¤‡ä»½ç­–ç•¥**ï¼š
   - é…ç½®å®šæœŸå¤‡ä»½é‡è¦æ•°æ®
   - è€ƒè™‘ä½¿ç”¨rsyncæˆ–äº‘å­˜å‚¨æœåŠ¡

5. **ç›‘æ§æœåŠ¡å™¨èµ„æº**ï¼š
   - å®‰è£…ç›‘æ§å·¥å…·å¦‚htop, iotop
   - è€ƒè™‘ä½¿ç”¨æ›´ä¸“ä¸šçš„ç›‘æ§è§£å†³æ–¹æ¡ˆå¦‚Prometheus+Grafana

## å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆ

### SSHè¿æ¥é—®é¢˜

**é—®é¢˜**ï¼š`Connection refused` é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥SSHæœåŠ¡æ˜¯å¦è¿è¡Œï¼š`sudo systemctl status ssh` æˆ– `service ssh status`
2. æ£€æŸ¥ç«¯å£æ˜¯å¦æ­£ç¡®ï¼š`sudo ss -tlnp | grep :ç«¯å£å·`
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®ï¼š`sudo ufw status`

**é—®é¢˜**ï¼š`Permission denied` é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®
2. æ£€æŸ¥SSHé…ç½®æ–‡ä»¶ä¸­çš„æƒé™è®¾ç½®
3. æŸ¥çœ‹SSHæ—¥å¿—ï¼š`sudo journalctl -u ssh` æˆ– `tail /var/log/auth.log`

### Dockeré—®é¢˜

**é—®é¢˜**ï¼š`permission denied while trying to connect to the Docker daemon socket`
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å°†ç”¨æˆ·æ·»åŠ åˆ°dockerç»„ï¼š`sudo usermod -aG docker $USER`
2. é‡æ–°ç™»å½•æˆ–ä½¿ç”¨ï¼š`newgrp docker`
3. æˆ–è€…ä½¿ç”¨sudoè¿è¡Œdockerå‘½ä»¤

**é—®é¢˜**ï¼šå®¹å™¨æ— æ³•è®¿é—®å¤–éƒ¨ç½‘ç»œ
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥DNSè®¾ç½®ï¼š`docker run --rm alpine nslookup google.com`
2. é‡å¯dockeræœåŠ¡ï¼š`sudo systemctl restart docker`
3. æ£€æŸ¥é˜²ç«å¢™è§„åˆ™

### é˜²ç«å¢™é—®é¢˜

**é—®é¢˜**ï¼šUFWè§„åˆ™ä¸ç”Ÿæ•ˆ
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥UFWçŠ¶æ€ï¼š`sudo ufw status verbose`
2. ç¡®ä¿è§„åˆ™é¡ºåºæ­£ç¡®ï¼ˆæ‹’ç»è§„åˆ™åœ¨æœ€åï¼‰
3. æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–é˜²ç«å¢™è§„åˆ™ï¼ˆå¦‚iptablesè§„åˆ™ï¼‰

### ç³»ç»Ÿæ€§èƒ½é—®é¢˜

**é—®é¢˜**ï¼šç³»ç»Ÿå“åº”ç¼“æ…¢
**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç³»ç»Ÿè´Ÿè½½ï¼š`htop`, `uptime`
2. æ£€æŸ¥ç£ç›˜ä½¿ç”¨ï¼š`df -h`, `du -sh *`
3. æ£€æŸ¥å†…å­˜ä½¿ç”¨ï¼š`free -h`
4. æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼š`netstat -tuln`

---

æ­å–œä½ ï¼ç°åœ¨ä½ çš„VPSå·²ç»å®Œæˆäº†åŸºç¡€çš„å®‰å…¨åŠ å›ºå’Œç³»ç»Ÿé…ç½®ï¼Œå¯ä»¥å¼€å§‹éƒ¨ç½²ä½ çš„åº”ç”¨å’ŒæœåŠ¡äº†ã€‚è®°ä½ï¼ŒæœåŠ¡å™¨å®‰å…¨æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ï¼Œå®šæœŸæ£€æŸ¥å’Œæ›´æ–°æ˜¯ä¿æŒæœåŠ¡å™¨å®‰å…¨çš„å…³é”®ã€‚